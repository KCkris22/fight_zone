{% extends "base.html" %}
{% block content %}

<!-- ðŸ”¥ YOUTUBE BACKGROUND -->
<div class="yt-bg">
    <iframe
        src="https://www.youtube.com/embed/7hd429vNaR4?autoplay=1&mute=1&loop=1&playlist=7hd429vNaR4&controls=0&showinfo=0&modestbranding=1"
        frameborder="0"
        allow="autoplay"
        allowfullscreen
    ></iframe>
</div>

<div class="overlay"></div>

<style>
html, body {
    height: 100%;
    overflow: hidden !important;
}

.yt-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    z-index: -3;
}

.yt-bg iframe {
    width: 150vw;
    height: 150vh;
    position: absolute;
    top: -20vh;
    left: -25vw;
    pointer-events: none;
    filter: brightness(60%);
    animation: bgZoom 15s ease-in-out infinite alternate;
}

@keyframes bgZoom {
    from { transform: scale(1); }
    to { transform: scale(1.08); }
}

.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.65);
    z-index: -2;
}

/* ðŸ”¥ FLASH EFFECT for Login button */
.flash-transition {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: radial-gradient(circle, rgba(255,0,0,0.9) 0%, rgba(0,0,0,1) 80%);
    opacity: 0;
    transform: scale(0.6);
    z-index: 5000;
    pointer-events: none;
    animation: flashEffect 0.5s forwards ease-out;
}

@keyframes flashEffect {
    0% { opacity: 0; transform: scale(0.6); }
    50% { opacity: 1; transform: scale(1.1); }
    100% { opacity: 0; transform: scale(1.4); }
}
</style>

<body class="register-page">

    <!-- Centered Logo -->
    <div class="logo-container">
        <div class="logo-box">
            <span class="logo-text">ðŸ¥Š FightZone ðŸ¥Š</span>
        </div>
    </div>

    <!-- Register Form -->
    <div class="form-container">
        <h2>Join the Fight Zone</h2>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for cat, msg in messages %}
                <div class="flash {{ cat }}">{{ msg }}</div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        {% if popup_message %}
        <div id="popup" class="popup">
            <div class="popup-content">
                <p>{{ popup_message }}</p>
                <button id="closePopup">OK</button>
            </div>
        </div>
        {% endif %}

        <!-- âœ” CORRECTED FORM to match new DB -->
        <form method="POST" novalidate>

            <!-- âœ” first_name / last_name -->
            <input type="text" name="first_name" placeholder="First Name" required>
            <input type="text" name="last_name" placeholder="Last Name" required>

            <!-- âœ” address -->
            <input type="text" name="address" placeholder="Enter Address" required>

            <!-- âœ” email / password -->
            <input type="email" name="email" placeholder="Enter Email" required>
            <input type="password" name="password" placeholder="Enter Password" required>

            <button type="submit">REQUEST VERIFICATION CODE</button>
        </form>

        <p>Already have an account?
            <a href="{{ url_for('login') }}" id="loginLink">Login here</a>
        </p>
    </div>

    <footer>Â© 2025 FightZone. All Rights Reserved.</footer>

    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const popup = document.getElementById("popup");
        const closeBtn = document.getElementById("closePopup");
        if (popup && closeBtn) {
            popup.style.display = "flex";
            closeBtn.addEventListener("click", () => popup.style.display = "none");
        }
    });

    /* ðŸ”¥ FLASH TRANSITION HANDLER */
    function triggerFlashAndGo(url) {
        const flash = document.createElement("div");
        flash.classList.add("flash-transition");
        document.body.appendChild(flash);

        setTimeout(() => { window.location.href = url; }, 450);
    }

    /* APPLY EFFECT TO LOGIN BUTTON */
    document.getElementById("loginLink").addEventListener("click", function(e) {
        e.preventDefault();
        triggerFlashAndGo("{{ url_for('login') }}");
    });
    </script>

    <style>
        .flash { margin: 12px auto; padding:10px; width:80%; text-align:center; border-radius:8px; }
        .flash.success { background:#111; border:2px solid #ff6666; color:white; box-shadow:0 0 12px red; }
        .flash.error { background:#111; border:2px solid #660000; color:white; box-shadow:0 0 12px darkred; }
    </style>

</body>

{% endblock %}