{% extends "base.html" %}

{% block content %}

{% if popup_message %}
<div id="notifModal" class="notif-modal">
    <div class="notif-box modal-animate">
        <h2 class="notif-title">Notification</h2>
        <p class="notif-text">{{ popup_message }}</p>
        <button class="notif-btn" onclick="closeNotif()">OK</button>
    </div>
</div>
{% endif %}

<section class="store-section">
    <h1 class="store-title">FightZone Store</h1>

    <div class="store-grid">

        <!-- Product 1 -->
        <div class="store-card">
            <img src="{{ url_for('static', filename='images/gloves.jpg') }}" class="store-pic">
            <h3>Pro Boxing Gloves</h3>
            <p class="price">â‚±2,499</p>
            <button class="store-btn" onclick="openPayment('Pro Boxing Gloves', 2499)">Buy Now</button>
        </div>

        <!-- Product 2 -->
        <div class="store-card">
            <img src="{{ url_for('static', filename='images/shirts.jpg') }}" class="store-pic">
            <h3>FightZone Shirt</h3>
            <p class="price">â‚±899</p>
            <button class="store-btn" onclick="openPayment('FightZone Shirt', 899)">Buy Now</button>
        </div>

        <!-- Product 3 -->
        <div class="store-card">
            <img src="{{ url_for('static', filename='images/handwraps.jpg') }}" class="store-pic">
            <h3>Hand Wraps</h3>
            <p class="price">â‚±299</p>
            <button class="store-btn" onclick="openPayment('Hand Wraps', 299)">Buy Now</button>
        </div>

        <!-- Product 4 -->
        <div class="store-card">
            <img src="{{ url_for('static', filename='images/jumprope.jpg') }}" class="store-pic">
            <h3>Jump Rope</h3>
            <p class="price">â‚±499</p>
            <button class="store-btn" onclick="openPayment('Jump Rope', 499)">Buy Now</button>
        </div>

        <!-- Product 5 -->
        <div class="store-card">
            <img src="{{ url_for('static', filename='images/mittpads.jpg') }}" class="store-pic">
            <h3>Mitt Pads</h3>
            <p class="price">â‚±1,299</p>
            <button class="store-btn" onclick="openPayment('Mitt Pads', 1299)">Buy Now</button>
        </div>

        <!-- Product 6 -->
        <div class="store-card">
            <img src="{{ url_for('static', filename='images/mouthguard.jpg') }}" class="store-pic">
            <h3>Mouth Guard</h3>
            <p class="price">â‚±199</p>
            <button class="store-btn" onclick="openPayment('Mouth Guard', 199)">Buy Now</button>
        </div>

        <!-- Product 7 -->
        <div class="store-card">
            <img src="{{ url_for('static', filename='images/wallbag.jpg') }}" class="store-pic">
            <h3>Wall Bag</h3>
            <p class="price">â‚±2,999</p>
            <button class="store-btn" onclick="openPayment('Wall Bag', 2999)">Buy Now</button>
        </div>

        <!-- Product 8 -->
        <div class="store-card">
            <img src="{{ url_for('static', filename='images/boxingshoes.jpg') }}" class="store-pic">
            <h3>Boxing Shoes</h3>
            <p class="price">â‚±3,499</p>
            <button class="store-btn" onclick="openPayment('Boxing Shoes', 3499)">Buy Now</button>
        </div>

        <!-- Product 9 -->
        <div class="store-card">
            <img src="{{ url_for('static', filename='images/headgear.jpg') }}" class="store-pic">
            <h3>Head Gear</h3>
            <p class="price">â‚±1,899</p>
            <button class="store-btn" onclick="openPayment('Head Gear', 1899)">Buy Now</button>
        </div>

    </div>
</section>

<!-- ============================
      PAYMENT CHOICE POPUP
=============================== -->
<div id="paymentPopup" class="popup-overlay">
    <div class="popup-box">
        <h3 id="storePopupTitle" class="popup-header"></h3>
        <p>Select a payment method:</p>

        <button class="payment-option-btn" onclick="openStoreGCash()">G-Cash</button>
        <button class="payment-option-btn" onclick="openStoreBankStep1()">Online Bank</button>

        <button class="close-btn" onclick="closeAllPopups()">Cancel</button>
    </div>
</div>

<!-- ============================
      STORE G-CASH POPUP
=============================== -->
<div id="storeGCashPopup" class="popup-overlay">
    <div class="popup-box">
        <h3 class="popup-header">Please scan QR via G-CASH</h3>

        <img src="{{ url_for('static', filename='images/gcash.jpg') }}" class="qr-image">

        <form method="POST" enctype="multipart/form-data" action="{{ url_for('store_pay') }}">
            <input type="hidden" id="storeProduct" name="product_name">
            <input type="hidden" id="storePrice" name="price">
            <input type="hidden" name="payment_method" value="GCASH">

            <label>Please upload your receipt for verification:</label>
            <input type="file" name="gcash_proof" accept=".jpg,.png,.pdf" required>

            <button class="proceed-btn" type="submit">Proceed</button>
        </form>

        <button class="close-btn" onclick="closeAllPopups()">Cancel</button>
    </div>
</div>

<!-- ============================
      STORE BANK STEP 1 POPUP (Choose Bank)
=============================== -->
<div id="storeBankStep1Popup" class="popup-overlay">
    <div class="popup-box">
        <h3 class="popup-header">Select Bank</h3>

        <button class="payment-option-btn" onclick="openStoreBankStep2('GoTyme')">GoTyme</button>
        <button class="payment-option-btn" onclick="openStoreBankStep2('Union Bank')">Union Bank</button>

        <button class="close-btn" onclick="closeAllPopups()">Cancel</button>
    </div>
</div>

<!-- ============================
      STORE BANK STEP 2 POPUP (QR or Card Input)
=============================== -->
<div id="storeBankStep2Popup" class="popup-overlay">
    <div class="popup-box">
        <h3 id="storeBankSelectedTitle" class="popup-header"></h3>
        <p>Select payment type:</p>

        <button class="payment-option-btn" onclick="openStoreBankQR()">QR Payment</button>
        <button class="payment-option-btn" onclick="openStoreBankCard()">Input Card Details</button>

        <button class="close-btn" onclick="closeAllPopups()">Cancel</button>
    </div>
</div>

<!-- ============================
      STORE BANK QR POPUP
=============================== -->
<div id="storeBankQRPopup" class="popup-overlay">
    <div class="popup-box">
        <h3 class="popup-header">Scan QR via Bank</h3>

        <img src="{{ url_for('static', filename='images/gcash.jpg') }}" class="qr-image">

        <form method="POST" enctype="multipart/form-data" action="{{ url_for('store_pay') }}">
            <input type="hidden" id="storeProductQR" name="product_name">
            <input type="hidden" id="storePriceQR" name="price">
            <input type="hidden" id="storeBankQRName" name="bank_name">
            <input type="hidden" name="payment_method" value="BANK">
            <input type="hidden" name="payment_type" value="QR">

            <label>Please upload your receipt for verification:</label>
            <input type="file" name="bank_proof" accept=".jpg,.png,.pdf" required>

            <button class="proceed-btn" type="submit">Proceed</button>
        </form>

        <button class="close-btn" onclick="closeAllPopups()">Cancel</button>
    </div>
</div>

<!-- ============================
      STORE BANK CARD INPUT POPUP
=============================== -->
<div id="storeBankCardPopup" class="popup-overlay">
    <div class="popup-box">
        <h3 class="popup-header">Enter Card Details</h3>

        <form method="POST" action="{{ url_for('store_pay') }}">
            <input type="hidden" id="storeProductCard" name="product_name">
            <input type="hidden" id="storePriceCard" name="price">
            <input type="hidden" id="storeBankCardName" name="bank_name">
            <input type="hidden" name="payment_method" value="BANK">
            <input type="hidden" name="payment_type" value="CARD">

            <label>Full Account Name:</label>
            <input type="text" name="fullname" required>

            <label>Card Number (16 digits):</label>
            <input type="text" maxlength="16" pattern="[0-9]{16}" name="card_number" required>

            <label>CVV (3 digits):</label>
            <input type="text" maxlength="3" pattern="[0-9]{3}" name="cvv" required>

            <button class="proceed-btn" type="submit">Proceed</button>
        </form>

        <button class="close-btn" onclick="closeAllPopups()">Cancel</button>
    </div>
</div>

<script>
// STORE PAYMENT VARIABLES
let storeProduct = "";
let storePrice = "";
let storeBankSelected = "";

// OPEN STORE PAYMENT
function openPayment(product, price) {
    storeProduct = product;
    storePrice = price;

    document.getElementById("storePopupTitle").innerText =
        `Buy ${product} â€” â‚±${price}`;

    document.getElementById("paymentPopup").style.display = "flex";
}

// OPEN STORE GCASH
function openStoreGCash() {
    document.getElementById("paymentPopup").style.display = "none";

    document.getElementById("storeProduct").value = storeProduct;
    document.getElementById("storePrice").value = storePrice;

    document.getElementById("storeGCashPopup").style.display = "flex";
}

// STEP 1: CHOOSE BANK
function openStoreBankStep1() {
    document.getElementById("paymentPopup").style.display = "none";
    document.getElementById("storeBankStep1Popup").style.display = "flex";
}

// STEP 2: BANK SELECTED
function openStoreBankStep2(bankName) {
    storeBankSelected = bankName;
    document.getElementById("storeBankStep1Popup").style.display = "none";

    document.getElementById("storeBankSelectedTitle").innerText =
        `Bank: ${bankName}`;

    document.getElementById("storeBankStep2Popup").style.display = "flex";
}

// BANK QR PAYMENT
function openStoreBankQR() {
    document.getElementById("storeBankStep2Popup").style.display = "none";

    document.getElementById("storeProductQR").value = storeProduct;
    document.getElementById("storePriceQR").value = storePrice;
    document.getElementById("storeBankQRName").value = storeBankSelected;

    document.getElementById("storeBankQRPopup").style.display = "flex";
}

// BANK CARD PAYMENT
function openStoreBankCard() {
    document.getElementById("storeBankStep2Popup").style.display = "none";

    document.getElementById("storeProductCard").value = storeProduct;
    document.getElementById("storePriceCard").value = storePrice;
    document.getElementById("storeBankCardName").value = storeBankSelected;

    document.getElementById("storeBankCardPopup").style.display = "flex";
}

// CLOSE ALL POPUPS
function closeAllPopups() {
    document.querySelectorAll(".popup-overlay")
        .forEach(p => p.style.display = "none");
}
</script>

<style>
/* Reuse membership popup styling */
.popup-overlay {
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    display:none;
    justify-content:center;
    align-items:center;
    background: rgba(0,0,0,0.8);
    z-index: 9999;
}
.popup-box {
    background:#111;
    border:3px solid red;
    box-shadow:0 0 20px red;
    padding:20px;
    width:380px;
    color:white;
    border-radius:12px;
    text-align:center;
}
.payment-option-btn,
.proceed-btn,
.close-btn {
    width:100%;
    padding:10px;
    margin-top:10px;
    background:red;
    border:none;
    color:black;
    font-weight:bold;
    border-radius:8px;
    cursor:pointer;
}
.qr-image {
    width:220px;
    display:block;
    margin:10px auto;
}

/* ----------------------
   STORE BACKGROUND + FALLING GLOVES
------------------------ */
.store-section {
    position: relative;
    background-color: #000;
    padding: 60px 20px;
    z-index: 1;
}

.store-bg-layer {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
}

.falling-glove {
    position: absolute;
    font-size: 20px;
    color: white;
    user-select: none;
    pointer-events: none;
    animation-name: fall;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
}

@keyframes fall {
    0% { transform: translateY(-50px) rotate(0deg); opacity:1; }
    100% { transform: translateY(100vh) rotate(360deg); opacity:0.7; }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const numberOfGloves = 80; // more gloves for full coverage
    const bgLayer = document.createElement('div');
    bgLayer.classList.add('store-bg-layer');
    document.body.prepend(bgLayer);

    for (let i = 0; i < numberOfGloves; i++) {
        const glove = document.createElement('div');
        glove.classList.add('falling-glove');
        glove.innerText = 'ðŸ¥Š';
        glove.style.left = Math.random() * 100 + 'vw';
        glove.style.fontSize = (15 + Math.random() * 25) + 'px';
        glove.style.animationDuration = (4 + Math.random() * 6) + 's';
        glove.style.animationDelay = Math.random() * 5 + 's';
        bgLayer.appendChild(glove);
    }
});
</script>

{% endblock %}