{% extends "base.html" %}
{% block content %}

<!-- YOUTUBE VIDEO BACKGROUND -->
<div class="yt-bg">
    <iframe
        src="https://www.youtube.com/embed/7hd429vNaR4?autoplay=1&mute=1&loop=1&playlist=7hd429vNaR4&controls=0&showinfo=0&modestbranding=1"
        frameborder="0"
        allow="autoplay"
        allowfullscreen
    ></iframe>
</div>

<div class="overlay"></div>

<style>
/* Disable default header from base.html */
.top-banner, .main-header {
    display: none !important;
}

/* Prevent scrolling */
html, body {
    height: 100%;
    overflow: hidden !important;
}

/* FightZone Header */
.register-header {
    width: 100%;
    height: 90px;
    background: #0d0d0d;
    border-top: 4px solid red;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 20px red;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 2000;
}

.register-header-logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.4rem;
    color: white;
    letter-spacing: 3px;
    text-shadow: 0 0 12px red;
    padding: 5px 25px;
}

/* Center Page Content */
.login-page {
    height: calc(100vh - 90px);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin-top: 30px;
}

/* Background styling */
.yt-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    z-index: -3;
}

.yt-bg iframe {
    width: 150vw;
    height: 150vh;
    position: absolute;
    top: -20vh;
    left: -25vw;
    pointer-events: none;
    filter: brightness(60%);
    animation: bgZoom 15s ease-in-out infinite alternate;
}

@keyframes bgZoom {
    from { transform: scale(1); }
    to { transform: scale(1.08); }
}

.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.65);
    z-index: -2;
}

/* RETURN BUTTON */
.return-btn {
    margin: -40px auto 0 auto;
    display: block;
    width: 150px;
    padding: 12px;
    background: red;
    color: black;
    text-align: center;
    font-weight: bold;
    font-size: 18px;
    border-radius: 10px;
    border: 2px solid #ff0000;
    cursor: pointer;
    text-decoration: none;
    box-shadow: 0 0 18px rgba(255,0,0,0.6);
    transition: 0.3s ease;
}

.return-btn:hover {
    transform: scale(1.07);
    background: #ff3b3b;
    box-shadow: 0 0 25px red;
}

/* üî• UNIVERSAL FLASH TRANSITION EFFECT */
.flash-transition {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: radial-gradient(circle, rgba(255,0,0,0.9) 0%, rgba(0,0,0,1) 80%);
    opacity: 0;
    transform: scale(0.6);
    z-index: 5000;
    pointer-events: none;
    animation: flashEffect 0.5s forwards ease-out;
}

@keyframes flashEffect {
    0% { opacity: 0; transform: scale(0.6); }
    50% { opacity: 1; transform: scale(1.1); }
    100% { opacity: 0; transform: scale(1.4); }
}

/* ============================= */
/*      ‚ùå CAPTCHA POPUP STYLE    */
/* ============================= */
.popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.85);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 7000;
}

.popup-box {
    background: #0d0d0d;
    border: 3px solid red;
    box-shadow: 0 0 25px red;
    padding: 25px 35px;
    text-align: center;
    width: 330px;
    border-radius: 12px;
    animation: popIn 0.25s ease-out;
}

.popup-box h3 {
    font-family: 'Bebas Neue', sans-serif;
    color: red;
    font-size: 2rem;
    margin-bottom: 10px;
    text-shadow: 0 0 10px red;
}

.popup-box p {
    color: white;
    margin-bottom: 20px;
    font-size: 1rem;
}

#retryBtn {
    width: 120px;
    padding: 10px;
    background: red;
    border: 2px solid #ff0000;
    color: black;
    font-weight: bold;
    font-size: 1.1rem;
    cursor: pointer;
    border-radius: 8px;
    box-shadow: 0 0 15px red;
    transition: 0.3s;
}

#retryBtn:hover {
    background: #ff3b3b;
    transform: scale(1.08);
    box-shadow: 0 0 22px red;
}

@keyframes popIn {
    from { transform: scale(0.6); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}
</style>

<!-- FightZone Header -->
<div class="register-header">
    <div class="register-header-logo">ü•ä FIGHTZONE ü•ä</div>
</div>

<!-- LOGIN CONTENT -->
<div class="login-page">

    <!-- ‚ùå CAPTCHA POPUP INSERTED HERE -->
    <div id="captchaPopup" class="popup-overlay">
        <div class="popup-box">
            <h3>WRONG INPUT</h3>
            <p>Please try again</p>
            <button id="retryBtn">RETRY</button>
        </div>
    </div>

    <div class="form-container">
        <h2>Login</h2>

        {% if error %}
        <div class="alert alert-error">{{ error }}</div>
        {% endif %}

        <form method="POST" action="/login" id="loginForm">
            <input type="text" name="email" placeholder="Email" required>
            <input type="password" name="password" placeholder="Password" required>

            <div id="captchaContainer" style="display:none; margin:15px 0; padding:15px; background:#f5f5f5; border-radius:5px;">
                <p style="margin:0 0 10px 0; font-weight:bold;">Enter the code:</p>
                <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
                    <span id="captchaCode"
                        style="background:#9e8d8d; border:2px solid #333; padding:10px 20px; font-size:24px; font-weight:bold; letter-spacing:5px; font-family:monospace; min-width:150px; text-align:center;">
                        XXXX
                    </span>
                    <button type="button" onclick="generateCaptcha()" style="padding:8px 12px; background:#ddd; border:none; border-radius:4px; cursor:pointer;">üîÑ</button>
                </div>
                <input type="text" id="captchaInput" placeholder="Type code here" maxlength="6"
                       style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
            </div>

            <button type="submit" id="loginBtn">Login</button>
        </form>

        <!-- REGISTER LINK (patched effect added) -->
        <p>Don't have an account?
            <a href="{{ url_for('register') }}" id="registerLink">Register</a>
        </p>
    </div>

    <!-- RETURN BUTTON -->
    <a href="{{ url_for('landing_page') }}" class="return-btn" id="returnBtn">‚¨Ö RETURN</a>
</div>

<script>
/* CAPTCHA LOGIC */
let captchaCode = '';
let captchaShown = false;

function generateCaptcha() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    captchaCode = '';
    for (let i = 0; i < 6; i++) {
        captchaCode += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    document.getElementById('captchaCode').textContent = captchaCode;
    document.getElementById('captchaInput').value = '';
    document.getElementById('captchaInput').focus();
}

document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();

    if (!captchaShown) {
        generateCaptcha();
        document.getElementById('captchaContainer').style.display = 'block';
        document.getElementById('loginBtn').textContent = 'Verify & Login';
        captchaShown = true;
        return;
    }

    const userInput = document.getElementById('captchaInput').value.toUpperCase();

    if (userInput !== captchaCode) {
        document.getElementById("captchaPopup").style.display = "flex";
        return;
    }

    this.submit();
});

/* RETRY BUTTON HANDLER */
document.getElementById("retryBtn").addEventListener("click", function() {
    document.getElementById("captchaPopup").style.display = "none";
    generateCaptcha();
    document.getElementById("captchaInput").value = "";
    document.getElementById("captchaInput").focus();
});

/* üî• REUSABLE FLASH TRANSITION */
function triggerFlashAndGo(url) {
    const flash = document.createElement("div");
    flash.classList.add("flash-transition");
    document.body.appendChild(flash);

    setTimeout(() => { window.location.href = url; }, 450);
}

/* RETURN BUTTON EFFECT */
document.getElementById("returnBtn").addEventListener("click", function(e) {
    e.preventDefault();
    triggerFlashAndGo("{{ url_for('landing_page') }}");
});

/* REGISTER BUTTON EFFECT */
document.getElementById("registerLink").addEventListener("click", function(e) {
    e.preventDefault();
    triggerFlashAndGo("{{ url_for('register') }}");
});
</script>

{% endblock %}