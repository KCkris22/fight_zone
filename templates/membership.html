{% extends "base.html" %}
{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

<style>
/* POPUP STATUS MESSAGE */
.status-popup {
    width: 60%;
    margin: 20px auto;
    padding: 20px;
    text-align: center;
    border-radius: 12px;
    font-weight: bold;
    background: #111;
    color: white;
    box-shadow: 0 0 20px red;
    animation: fadeIn 0.5s ease-out;
}

.status-success { border: 3px solid red; }
.status-error { border: 3px solid darkred; }
.status-pending { border: 3px solid #b30000; }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px);}
    to { opacity: 1; transform: translateY(0);}
}

/* Hide after 5 seconds */
.status-popup.fade-out {
    animation: fadeOut 1s forwards;
}

@keyframes fadeOut {
    to { opacity: 0; transform: translateY(-20px);}
}
</style>

<!-- STATUS POPUP -->
{% if status == 'Pending' %}
<div id="statusBox" class="status-popup status-pending">
    <h3>Payment Pending</h3>
    <p>Your G-Cash payment is waiting for admin approval.</p>
</div>
{% elif status == 'Accepted' %}
<div id="statusBox" class="status-popup status-success">
    <h3>Payment Approved</h3>
    <p>Your membership is now active!</p>
</div>
{% elif status == 'Rejected' %}
<div id="statusBox" class="status-popup status-error">
    <h3>Payment Rejected</h3>
    <p>Please submit a valid payment proof.</p>
</div>
{% endif %}

<script>
// Auto fade status alert
setTimeout(() => {
    const box = document.getElementById("statusBox");
    if (box) {
        box.classList.add("fade-out");
        setTimeout(() => box.remove(), 1000);
    }
}, 4000);
</script>

<section class="membership-container">
    <h2 class="membership-title">Membership Options</h2>

    <div class="plans-wrapper">

        <!-- BEGINNER -->
        <div class="plan-card">
            <h3>Beginner</h3>
            <p class="price">‚Ç±1,000 / month</p>
            <ul>
                <li>Basic Gym Access</li>
                <li>Free Starter Gloves</li>
                <li>2 Sessions / Week</li>
            </ul>
            <button class="join-btn" onclick="openPayment('Beginner', 1000)">Join Now</button>
        </div>

        <!-- AMATEUR -->
        <div class="plan-card">
            <h3>Amateur</h3>
            <p class="price">‚Ç±2,000 / month</p>
            <ul>
                <li>Full Gym Access + Sparring</li>
                <li>Weekly Group Training</li>
                <li>1-on-1 Session / Week</li>
            </ul>
            <button class="join-btn" onclick="openPayment('Amateur', 2000)">Join Now</button>
        </div>

        <!-- PRO -->
        <div class="plan-card">
            <h3>Pro</h3>
            <p class="price">‚Ç±3,500 / month</p>
            <ul>
                <li>Unlimited Access</li>
                <li>Personal Trainer</li>
                <li>Fight Simulation + Gear</li>
            </ul>
            <button class="join-btn" onclick="openPayment('Pro', 3500)">Join Now</button>
        </div>

    </div>
</section>

<!-- PAYMENT CHOICE POPUP -->
<div id="paymentPopup" class="popup-overlay">
    <div class="popup-box">
        <h3 id="paymentTitle" class="popup-header"></h3>
        <p>Select a payment method:</p>

        <button class="payment-option-btn" onclick="openGCash()">üì± G-Cash</button>
        <button class="payment-option-btn" onclick="openBank()">üè¶ Online Bank</button>

        <button class="close-btn" onclick="closeAllPopups()">Cancel</button>
    </div>
</div>

<!-- GCASH POPUP -->
<div id="gcashPopup" class="popup-overlay">
    <div class="popup-box">
        <h3 class="popup-header">G-Cash Payment</h3>

        <img src="{{ url_for('static', filename='images/gcash.jpg') }}" class="qr-image">

        <form id="gcashForm" method="POST" enctype="multipart/form-data" action="/pay/gcash">
            <input type="hidden" id="gcashPlan" name="plan">
            <input type="hidden" id="gcashPrice" name="price">

            <label>Upload G-Cash Proof (jpg, png, pdf):</label>
            <input type="file" name="payment_proof" accept=".jpg,.png,.pdf" required>

            <button class="proceed-btn" type="submit">Proceed</button>
        </form>

        <button class="close-btn" onclick="closeAllPopups()">Cancel</button>
    </div>
</div>

<!-- BANK POPUP -->
<div id="bankPopup" class="popup-overlay">
    <div class="popup-box">
        <h3 class="popup-header">Online Bank Payment</h3>

        <form id="bankForm" method="POST" action="/pay/bank">
            <input type="hidden" id="bankPlan" name="plan">
            <input type="hidden" id="bankPrice" name="price">

            <label>Full Name:</label>
            <input type="text" name="fullname" required>

            <label>Card Number (16 digits):</label>
            <input type="text" name="card_number" maxlength="16" pattern="[0-9]{16}" required>

            <label>CVV (3 digits):</label>
            <input type="text" name="cvv" maxlength="3" pattern="[0-9]{3}" required>

            <button class="proceed-btn" type="submit">Proceed</button>
        </form>

        <button class="close-btn" onclick="closeAllPopups()">Cancel</button>
    </div>
</div>

<script>
let chosenPlan = "";
let chosenPrice = "";

// OPEN PAYMENT OPTIONS
function openPayment(plan, price) {
    chosenPlan = plan;
    chosenPrice = price;

    document.getElementById("paymentTitle").innerText =
        `Join ${plan} Plan ‚Äî ‚Ç±${price}`;

    document.getElementById("paymentPopup").style.display = "flex";
}

// OPEN GCASH
function openGCash() {
    document.getElementById("paymentPopup").style.display = "none";

    document.getElementById("gcashPlan").value = chosenPlan;
    document.getElementById("gcashPrice").value = chosenPrice;

    document.getElementById("gcashPopup").style.display = "flex";
}

// OPEN BANK
function openBank() {
    document.getElementById("paymentPopup").style.display = "none";

    document.getElementById("bankPlan").value = chosenPlan;
    document.getElementById("bankPrice").value = chosenPrice;

    document.getElementById("bankPopup").style.display = "flex";
}

// CLOSE ALL POPUPS
function closeAllPopups() {
    document.querySelectorAll(".popup-overlay").forEach(p => p.style.display = "none");
}
</script>

{% endblock %}