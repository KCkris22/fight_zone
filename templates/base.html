<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FightZone</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body id="site-body" class="fade-transition">
    {% if request.endpoint not in ['login', 'register'] %}
    <!-- Navbar for Logged-In Pages -->
    <header class="top-banner">
        <div class="logo-box">
            <a href="{{ url_for('home') }}" class="logo-text">ðŸ¥Š FightZone ðŸ¥Š</a>
        </div>
        <nav class="nav-links">
            <a href="{{ url_for('my_account') }}" class="nav-btn my-account-link">My Account</a>
            <a href="{{ url_for('about') }}" class="nav-btn">About</a>
            <a href="{{ url_for('benefits') }}" class="nav-btn">Benefits</a>
            <a href="{{ url_for('membership') }}" class="nav-btn">Membership</a>
            <a href="{{ url_for('store') }}" class="nav-btn">Store</a>
            <a href="{{ url_for('logout') }}" class="nav-btn logout">Logout</a>
        </nav>
    </header>
    {% endif %}

    <!-- Page Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 FightZone Gym â€” All rights reserved. | Founder: Cynrics</p>
    </footer>

<script>
(function(){
    const body = document.getElementById("site-body");

    // Only logged-in pages should fade
    const isLoggedIn = {{ 'true' if session.get('user_id') else 'false' }};

    // Allowed pages for transitions
    const allowedRoutes = ["/home", "/about", "/benefits", "/membership", "/store", "/my_account"];

    function isAllowed(url) {
        try {
            const u = new URL(url, window.location.href);
            return allowedRoutes.includes(u.pathname);
        } catch {
            return false;
        }
    }

    if (!isLoggedIn) return;

    // Intercept link clicks for fade effect
    document.addEventListener("click", function(e){
        if (e.defaultPrevented) return;
        if (e.button !== 0) return;
        if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;

        let a = e.target;
        while (a && a.tagName !== "A") a = a.parentElement;
        if (!a || !a.href) return;
        if (!isAllowed(a.href)) return;

        e.preventDefault();

        // Add glow for My Account link if clicked
        if (a.classList.contains("my-account-link")) {
            a.classList.add("clicked");
            setTimeout(() => {
                body.classList.add("fade-out");
                setTimeout(() => { window.location.href = a.href; }, 350);
            }, 200); // short delay to show glow
        } else {
            body.classList.add("fade-out");
            setTimeout(() => { window.location.href = a.href; }, 350);
        }
    });

})();
</script>

<style>
/* Fade transition */
#site-body.fade-transition {
  opacity: 1;
  transition: opacity 350ms ease-in-out;
}
#site-body.fade-out {
  opacity: 0 !important;
}

/* Navbar buttons */
.nav-btn {
    padding: 8px 16px;
    border-radius: 6px;
    text-decoration: none;
    color: white;
    transition: all 0.3s ease;
}

/* Dynamic red glow for My Account link when clicked */
.my-account-link.clicked {
    animation: pulse-red 1.5s infinite alternate;
}

@keyframes pulse-red {
    0% { box-shadow: 0 0 5px #ff0000, 0 0 10px #ff4d4d, 0 0 15px #ff6666; }
    50% { box-shadow: 0 0 10px #ff0000, 0 0 20px #ff4d4d, 0 0 30px #ff6666; }
    100% { box-shadow: 0 0 5px #ff0000, 0 0 10px #ff4d4d, 0 0 15px #ff6666; }
}
</style>

</body>
</html>